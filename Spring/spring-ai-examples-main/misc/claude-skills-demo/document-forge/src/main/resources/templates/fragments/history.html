<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<!-- History List Fragment -->
<div th:fragment="list">
    <!-- Empty State -->
    <div th:if="${history.isEmpty()}" class="text-center py-8 text-gray-400">
        <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
        </svg>
        <p class="text-sm">No history yet</p>
    </div>

    <!-- History Items -->
    <div th:unless="${history.isEmpty()}" class="space-y-2">
        <th:block th:each="item : ${history}">
            <div class="history-item p-3 rounded-lg border border-gray-100 cursor-pointer group"
                 onclick="loadPromptFromHistory(this)"
                 th:data-id="${item.id()}"
                 th:data-prompt="${item.prompt()}"
                 th:data-document-type="${item.documentType().name()}">
                <div class="flex items-start space-x-3">
                    <!-- Document Type Icon -->
                    <th:block th:switch="${item.documentType().name()}">
                        <div th:case="'XLSX'" class="w-8 h-8 rounded flex-shrink-0 flex items-center justify-center bg-green-100">
                            <svg class="w-4 h-4 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div th:case="'PPTX'" class="w-8 h-8 rounded flex-shrink-0 flex items-center justify-center bg-orange-100">
                            <svg class="w-4 h-4 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                        </div>
                        <div th:case="'DOCX'" class="w-8 h-8 rounded flex-shrink-0 flex items-center justify-center bg-blue-100">
                            <svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                        <div th:case="*" class="w-8 h-8 rounded flex-shrink-0 flex items-center justify-center bg-red-100">
                            <svg class="w-4 h-4 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                            </svg>
                        </div>
                    </th:block>

                    <div class="flex-1 min-w-0">
                        <!-- Prompt Preview -->
                        <p class="text-sm text-gray-800 truncate" th:text="${#strings.abbreviate(item.prompt(), 50)}">
                            Prompt preview...
                        </p>
                        <!-- Timestamp and Status -->
                        <div class="flex items-center space-x-2 mt-1">
                            <span class="text-xs text-gray-400" th:text="${#temporals.format(item.createdAt(), 'MMM d, HH:mm')}">
                                Nov 27, 14:30
                            </span>
                            <th:block th:if="${item.pending()}">
                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                    <svg class="w-3 h-3 mr-1 animate-spin" fill="none" viewBox="0 0 24 24">
                                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                                    </svg>
                                    Generating...
                                </span>
                            </th:block>
                            <th:block th:if="${item.success()}">
                                <button th:hx-get="@{/history/{id}(id=${item.id()})}"
                                        hx-target="#response-area"
                                        hx-swap="innerHTML"
                                        onclick="event.stopPropagation()"
                                        class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-green-100 text-green-800 hover:bg-green-200 transition-colors">
                                    <svg class="w-3 h-3 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                                    </svg>
                                    View
                                </button>
                            </th:block>
                            <th:block th:if="${!item.pending() and !item.success()}">
                                <span class="inline-flex items-center px-1.5 py-0.5 rounded text-xs font-medium bg-red-100 text-red-800">
                                    Failed
                                </span>
                            </th:block>
                        </div>
                    </div>

                    <!-- Delete Button -->
                    <button th:hx-delete="@{/history/{id}(id=${item.id()})}"
                            hx-target="#history-list"
                            hx-swap="innerHTML"
                            onclick="event.stopPropagation()"
                            class="opacity-0 group-hover:opacity-100 p-1 text-gray-400 hover:text-red-500 transition-all"
                            title="Delete from history">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
        </th:block>
    </div>
</div>

<!-- Cleared State Fragment -->
<div th:fragment="cleared" class="text-center py-8 text-gray-400">
    <svg class="w-12 h-12 mx-auto mb-2 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
    </svg>
    <p class="text-sm">No history yet</p>
</div>

</html>
